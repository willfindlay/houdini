name: write-etc-passwd

steps:
  - createEnvironment:
      kernelTag: "5.13.19"
      kconfig: "~/Desktop/buildroot-bpfcontain/test/linux-5.13.19-config/.config"
      bconfig: "~/Desktop/buildroot-bpfcontain/test/buildroot-config/.config"
  # Copy /etc/passwd to /tmp/passwd so that we aren't messing with anything important
  - host:
      script:
      - command: cp
        args: ["/etc/passwd", "/tmp/passwd"]
      failure: setupFailure
  - spawnContainer:
      name: bash
      image: bash
      cmd: sleep infinity
      volumes:
      - "/tmp/passwd:/passwd"
      failure: setupFailure
  - container:
      name: bash
      script:
      - command: bash
        args: ["-c", "echo foo > /passwd"]
      failure: exploitFailure
      success: exploitSuccess
